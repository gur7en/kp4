\chapter{Разработка спецификации требований}
\label{chap:spec}

\section{Постановка задачи}
Грузовые перевозки. Компания осуществляет перевозки грузов 
по различным маршрутам. Необходимо отслеживать стоимость перевозок 
с учётом заработной платы водителей. Для каждого маршрута определено 
название, вычислено примерное расстояние и установлена некоторая оплата 
для водителя. Информация о водителях включает фамилию, имя, отчество и стаж. 
Для проведения расчётов хранится полная информация о перевозках 
(маршрут, водитель, даты отправки и прибытия). По факту некоторых 
перевозок водителям выплачивается премия. Фирма решила ввести гибкую 
систему оплаты. Оплата водителям должна зависеть не только от маршрута, 
но и от стажа водителя. Кроме того, нужно учесть, что перевозку 
могут осуществлять два водителя.

\section{Выявление ролей и функций, диаграммы прецедентов}
В разрабатываемой системе были выделены следующие роли: 
водитель, логист, бухгалтер. 
От введения отдельной роли администратора было решено отказаться, 
поскольку для любых его задач значительно эффективнее будет работать
напрямую с базой данных, применяя специализированные инструменты.

На рисунках~\ref{fig:usecase:driver}
,~\ref{fig:usecase:accounter} 
и~\ref{fig:usecase:logist}~
представлены диаграммы прецедентов для 
водителя, бухгалтера и логиста соответственно. 
На рисунке~\ref{fig:usecase:all} 
представлена диаграмма прецедентов, которые относятся сразу ко всем ролям.

В приложении~\ref{chap:states} представлены диаграммы потоков экранов.

\image[0.5]
    {diagrams/usecase/driver}
    {Диаграмма прецедентов водителя}
    {fig:usecase:driver}

\image
    {diagrams/usecase/accounter}
    {Диаграмма прецедентов бухгалтера}
    {fig:usecase:accounter}

\image
    {diagrams/usecase/logist}
    {Диаграмма прецедентов логиста}
    {fig:usecase:logist}

\image
    {diagrams/usecase/all}
    {Диаграмма прецедентов всех пользователей}
    {fig:usecase:all}



\section{Текстовое описание прецедентов и макеты интерфейса}

\subsection{Прецедент <<войти в систему>>}
\textbf{Роли:} все \par
\textbf{Цель сценария:} войти в систему \par
\textbf{Предусловия:} открыто <<Окно входа в программу>> 
    (рис.~\ref{fig:ui:login}) \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Ввести имя пользователя;
    \item Ввести пароль;
    \item Нажать кнопку <<Войти>>;
    \item Система проверяет наличие пользователя в базе;
    \item Система проверяет, что введён правильный пароль;
    \item Пользователь существует и пароль введён верно, 
        поэтому система открывает <<Домашнее окно>>.
\end{enumerate} \par
\textbf{Постусловия:} открыто <<Домашнее окно>>, окно входа закрыто. \par
\textbf{Альтернативная последовательность (пользователь не существует):} \par
\begin{enumerate}
    \item Вся последовательность сохраняется. Однако указанный пользователь 
        отсутствует в базе.
\end{enumerate} \par
\textbf{Постусловия:} отображается сообщение об ошибке. \par
\textbf{Альтернативная последовательность (пароль не верен):} \par
\begin{enumerate}
    \item Вся последовательность сохраняется. Однако введён неверный пароль.
\end{enumerate} \par
\textbf{Постусловия:} отображается сообщение об ошибке. \par
\image[0.5]
    {diagrams/salt/login}
    {Окно входа в программу}
    {fig:ui:login}

\subsection{Прецедент <<сменить пароль>>}
\textbf{Роли:} все \par
\textbf{Цель сценария:} изменить пароль пользователя для входа в систему \par
\textbf{Предусловия:} открыта вкладка <<Профиль>> 
    (рис.~\ref{fig:ui:profile}) \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Ввести текущий пароль в поле <<Текущий пароль>>;
    \item Ввести новый пароль в поле <<Новый пароль>>;
    \item Ввести новый пароль в поле <<Повторите новый пароль>>;
    \item Нажать кнопку <<Изменить пароль>>;
    \item Система проверяет совпадение пароля в двух полях ввода;
    \item Пароли совпадают, поэтому выводится окно с запросом подтверждения;
    \item В появившемся окне нажать кнопку <<Подтвердить>>.
\end{enumerate} \par
\textbf{Постусловия:} пароль пользователя для входа в систему изменён. \par
\textbf{Альтернативная последовательность (отказ от смены пароля):} \par
\begin{enumerate}
    \item Последовательность сохраняется до нажатия кнопки <<Подтвердить>>, 
        вместо которой нажата кнопка <<Отмена>>.
\end{enumerate} \par
\textbf{Постусловия:} тображается сообщение об ошибке. \par
\textbf{Альтернативная последовательность (пароли не совпадают):} \par
\begin{enumerate}
    \item Вся последовательность сохраняется. Однако пароли не совпадают.
\end{enumerate} \par
\textbf{Постусловия:} отображается сообщение об ошибке. \par
\image[0.6]
    {diagrams/salt/profile}
    {Вкладка профиля пользователя}
    {fig:ui:profile}


\subsection{Прецедент <<выйти из системы>>}
\textbf{Роли:} все \par
\textbf{Цель сценария:} выйти из системы \par
\textbf{Предусловия:} открыта вкладка <<Профиль>> 
    (рис.~\ref{fig:ui:profile}) \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Нажать кнопку <<Выйти из системы>>;
    \item В появившемся окне нажать кнопку <<Подтвердить>>.
\end{enumerate} \par
\textbf{Постусловия:} сеанс пользователя будет завершён, 
    ранее открытые окна закрыты, откроется <<Окно входа в программу>> \par
\textbf{Альтернативная последовательность (остаться в системе):} \par
\begin{enumerate}
    \item Последовательность сохраняется до нажатия кнопки <<Подтвердить>>, 
        вместо которой нажата кнопка <<Отмена>>.
\end{enumerate} \par
\textbf{Постусловия:} Возврат к домашнему окну \par

\subsection{Прецедент <<просмотреть зарплату водителя>>}
\textbf{Роли:} бухгалтер \par
\textbf{Цель сценария:} получить список завершённых перевозок водителя 
    с информацией о вознаграждении за них \par
\textbf{Предусловия:} открыта вкладка <<Водители>> 
    (рис.~\ref{fig:ui:profile}), список водителей не пуст \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Выбрать в списке нужного водителя;
    \item Нажать кнопку <<Перевозки>>;
    \item В появившемся окне (рис.~\ref{fig:ui:period} выбрать один из 
    предусмотренных периодов либо задать желаемый период вручную.
\end{enumerate} \par
\textbf{Постусловия:} доступен к просмотру список завершённых 
    перевозок водителя с информацией о вознаграждении за них \par
\image
    {diagrams/salt/accountertabdrivers}
    {Вкладка водителей}
    {fig:ui:drivers}
\image
    {diagrams/salt/accounterperiod}
    {Вкладка перевозок водителя за период}
    {fig:ui:period}

\subsection{Прецедент <<просмотреть список пользователей>>}
\textbf{Роли:} бухгалтер \par
\textbf{Цель сценария:} получить список пользователей с заданной ролью \par 
\textbf{Предусловия:} открыто домашнее окно \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Переключиться на вкладку с требуемой ролью пользователей
\end{enumerate} \par
\textbf{Постусловия:} доступен к просмотру список пользователей
    с выбранной ролью, содержащий всю имеющуюся в базе данных информацию \par

\subsection{Прецедент <<назначить перевозку>>}
\textbf{Роли:} логист \par
\textbf{Цель сценария:} назначить новую перевозку \par
\textbf{Предусловия:} открыта вкладка <<Перевозки>> 
    (рис.~\ref{fig:ui:tabhaul} в домашнем окне \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Нажать кнопку <<Добавить>>;
    \item В открывшейся вкладке (рис.~\ref{fig:ui:addhaul}) 
        выбрать нужного водителя в выпадающем списке <<Водитель>>;
    \item Если нужен второй водитель, выбрать его
        в выпадающем списке <<Второй водитель>>;
    \item Выбрать маршрут в выпадающем списке <<Маршрут>>;
    \item Если нужно, ввести значения премий водителей за данную перевозку;
    \item Нажать кнопку <<Подтвердить>>.
\end{enumerate} \par
\textbf{Постусловия:} назначена новая перевозка \par
\textbf{Альтернативная последовательность 
    (возврат к списку перевозок без назначения перевозки):} \par
\begin{enumerate}
    \item Последовательность сохраняется до нажатия кнопки <<Подтвердить>>, 
        вместо которой нажата кнопка <<Отмена>>.
\end{enumerate} \par
\textbf{Постусловия:} возврат к домашнему окну, изменения не вносятся \par
\image
    {diagrams/salt/logisttabhaul}
    {Вкладка перевозок}
    {fig:ui:tabhaul}

\image
    {diagrams/salt/logistaddhaul}
    {Вкладка добавления перевозки}
    {fig:ui:addhaul}


\subsection{Прецедент <<отменить перевозку>>}
\textbf{Роли:} логист \par
\textbf{Цель сценария:} пометить перевозку отменённой \par
\textbf{Предусловия:} открыта вкладка <<Перевозки>> в домашнем окне, 
     список перевозок не пуст \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Выбрать в списке перевозку, которую необходимо отменить;
    \item Нажать правую кнопку мыши для вызова контекстного меню;
    \item В контекстном меню нажать кнопку <<Отменить>>;
    \item В появившемся окне нажать кнопку <<Подтвердить>>.
\end{enumerate} \par
\textbf{Постусловия:} перевозка помечена отменённой \par
\textbf{Альтернативная последовательность 
    (возврат к списку перевозок без отмены перевозки):} \par
\begin{enumerate}
    \item Последовательность сохраняется до нажатия кнопки <<Подтвердить>>, 
        вместо которой нажата кнопка <<Отмена>>.
\end{enumerate} \par
\textbf{Постусловия:} возврат к домашнему окну, изменения не вносятся \par

\subsection{Прецедент <<завершить перевозку>>}
\textbf{Роли:} логист \par
\textbf{Цель сценария:} пометить перевозку успешно завершённой \par
\textbf{Предусловия:} открыта вкладка <<Перевозки>> в домашнем окне, 
     список перевозок не пуст \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Выбрать в списке перевозку, которую необходимо завершить;
    \item Нажать правую кнопку мыши для вызова контекстного меню;
    \item В контекстном меню нажать кнопку <<Завершить>>;
    \item В появившемся окне нажать кнопку <<Подтвердить>>.
\end{enumerate} \par
\textbf{Постусловия:} перевозка помечена успешно завершённой \par
\textbf{Альтернативная последовательность 
    (возврат к списку перевозок без завершения перевозки):} \par
\begin{enumerate}
    \item Последовательность сохраняется до нажатия кнопки <<Подтвердить>>, 
        вместо которой нажата кнопка <<Отмена>>.
\end{enumerate} \par
\textbf{Постусловия:} возврат к домашнему окну, изменения не вносятся \par

\subsection{Прецедент <<добавить маршрут>>}
\textbf{Роли:} логист \par
\textbf{Цель сценария:} внести в базу новый маршрут \par
\textbf{Предусловия:} открыта вкладка <<Маршруты>> 
    в домашнем окне (рис.~\ref{fig:ui:tabroutes}) \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Нажать правую кнопку мыши для вызова контекстного меню;
    \item В контекстном меню нажать кнопку <<Добавить маршрут>>;
    \item В открывшейся вкладке (рис.~\ref{fig:ui:addroute}) 
        ввести данные маршрута;
    \item Нажать кнопку <<Подтвердить>>.
\end{enumerate} \par
\textbf{Постусловия:} в базу добавлен новый маршрут \par
\textbf{Альтернативная последовательность 
    (возврат к списку маршрутов без добавления нового маршрута):} \par
\begin{enumerate}
    \item Последовательность сохраняется до нажатия кнопки <<Подтвердить>>, 
        вместо которой нажата кнопка <<Отмена>>.
\end{enumerate} \par
\textbf{Постусловия:} возврат к домашнему окну, изменения не вносятся \par
\image
    {diagrams/salt/logisttabroutes}
    {Вкладка маршрутов}
    {fig:ui:tabroutes}
\image
    {diagrams/salt/logistaddroute}
    {Вкладка добавления перевозки}
    {fig:ui:addroute}

\subsection{Прецедент <<удалить маршрут>>}
\textbf{Роли:} логист \par
\textbf{Цель сценария:} пометить маршрут в базе неиспользуемым \par
\textbf{Предусловия:} открыта вкладка <<Маршруты>> в домашнем окне,
    список маршрутов не пуст \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item Нажать правую кнопку мыши для вызова контекстного меню;
    \item В контекстном меню нажать кнопку <<Удалить маршрут>>;
    \item Нажать кнопку <<Подтвердить>>.
\end{enumerate} \par
\textbf{Постусловия:} маршрут в базе помечен, как более не используемый \par
\textbf{Альтернативная последовательность 
    (возврат к списку маршрутов без удаления маршрута):} \par
\begin{enumerate}
    \item Последовательность сохраняется до нажатия кнопки <<Подтвердить>>, 
        вместо которой нажата кнопка <<Отмена>>.
\end{enumerate} \par
\textbf{Постусловия:} возврат к домашнему окну, изменения не вносятся \par

\subsection{Прецедент <<посмотреть свои перевозки>>}
\textbf{Роли:} водитель \par
\textbf{Цель сценария:} просмотреть список перевозок и 
    зарплату за определённый период \par
\textbf{Предусловия:} открыта вкладка <<Перевозки>> 
    в домашнем окне (рис.~\ref{fig:ui:drivertabhaul}) \par
\textbf{Основной сценарий:} 
\begin{enumerate}
    \item В области редактирования периодов выбрать 
        один из предусмотренных периодов либо задать желаемый период вручную;
    \item Система проверяет валидность периода;
    \item Период валиден, поэтому система отображает список 
        завершённых в выбранный период перевозок с информацией 
        об оплате за них по отдельности и в сумме за все.
\end{enumerate} \par
\textbf{Постусловия:} доступен к просмотру список завершённых 
    в выбранный период перевозок с информацией об оплате за них \par
\textbf{Альтернативная последовательность (указан невалидный период):} \par
\begin{enumerate}
    \item Вся последовательность сохраняется. Однако период невалиден.
\end{enumerate} \par
\textbf{Постусловия:} отображается сообщение об ошибке \par
\image
    {diagrams/salt/drivertabhaul}
    {Домашнее окно водителя}
    {fig:ui:drivertabhaul}



\section{Описание форматов данных}

Для хранения информации пректируемая система будет использовать реляционную
базу данных. Далее приведена информация о составляющих её таблицах.

\newcommand\dbtable[4]{
    Информация о #1 хранится в базе данных в таблице, структура которой
    представлена далее в таблице \ref{table:db:#2}. #4
    \begin{table}[h!]
        \centering
        \caption{Структура таблицы, хранящей информацию о #1}
        \begin{tabularx}{\textwidth}{|X|X|}
            \hline
            Поле & Тип \\
            \hhline{|=:=|}
            #3
        \end{tabularx}
        \label{table:db:#2}
    \end{table}
}

\dbtable{маршрутах}{routes}{
    Уникальный идентификатор & Число \\ \hline
    Активность & Логический \\ \hline
    Начальная точка & Строка \\ \hline
    Конечная точка & Строка \\ \hline
    Длина (км) & Число \\ \hline
    Комментарий & Строка \\ \hline
    Цена для клиента & Денежная сумма \\ \hline
    Вознаграждение водителя (база) & Денежная сумма \\ \hline
}{}

\dbtable{перевозках}{haulages}{
    Уникальный идентификатор & Число \\ \hline
    Статус & Число \\ \hline
    Начато & Время \\ \hline
    Завершено & Время \\ \hline
}{}

\dbtable{пользователях}{users}{
    Уникальный идентификатор & Число \\ \hline
    Роль & Строка \\ \hline
    Логин & Строка \\ \hline
    Пароль & Строка MD5 \\ \hline
    фамилия & Строка \\ \hline
    Имя & Строка \\ \hline
    Отчество & Строка \\ \hline
    Телефон & Строка \\ \hline
    Комментарий & Строка \\ \hline
}{}

\dbtable{водителях}{drivers}{
    Уникальный идентификатор & Число \\ \hline
    Стаж вождения (лет) & Число \\ \hline
}{
    Данная таблица дополняет общие данные о пользователе 
    специфичными для роли водителя сведениями.
}

\dbtable{перевозках водителей}{drvhaul}{
    Идентификатор перевозки & Число \\ \hline
    Идентификатор водителя & Число \\ \hline
    Премия водителя & Денежная сумма \\ \hline
}{
    Данная таблица позволит связать с одной перевозкой 
    произвольное количество водителей.
}
